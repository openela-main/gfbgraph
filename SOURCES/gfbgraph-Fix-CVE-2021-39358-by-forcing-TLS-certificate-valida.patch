From c294b06ec0f3a0b8e3f6292de962e048bbd7774a Mon Sep 17 00:00:00 2001
From: "Douglas R. Reno" <renodr@linuxfromscratch.org>
Date: Wed, 15 Sep 2021 17:40:00 +0000
Subject: [PATCH] Fix CVE-2021-39358 by forcing TLS certificate validation.

This is similar to the fix performed in other packages. See https://gitlab.gnome.org/Teams/Releng/security/-/issues/57 for more details. Note that this is my first non-documentation commit to a GNOME package, but I'm a distributor and want to see this fixed.

Tested on Linux From Scratch 11.0 and on Debian 11.

Fixes #17
---
 gfbgraph/gfbgraph-photo.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/gfbgraph/gfbgraph-photo.c b/gfbgraph/gfbgraph-photo.c
index 69eb98db2576..2ebb9aaf8db1 100644
--- a/gfbgraph/gfbgraph-photo.c
+++ b/gfbgraph/gfbgraph-photo.c
@@ -422,6 +422,7 @@ gfbgraph_photo_download_default_size (GFBGraphPhoto *photo, GFBGraphAuthorizer *
 
         session = soup_session_sync_new ();
         requester = soup_requester_new ();
+        g_object_set (G_OBJECT (session), "ssl-use-system-ca-file", TRUE, NULL);
         soup_session_add_feature (session, SOUP_SESSION_FEATURE (requester));
 
         request = soup_requester_request (requester, priv->source, error);
-- 
2.31.1

